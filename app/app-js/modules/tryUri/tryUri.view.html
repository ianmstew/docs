<div id="alert-area">
</div>

<h1>User Profile</h1>
<h3>URI Format:</h3>
<p>
  <code id='sampleUri'></code>
</p>

<div class="bar">
  <form role="form">
    <div class="input-group js-input-container">
      <textarea id="sample-uri" class="js-input-expand" rows="1" cols="100">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc ut vehicula mi. Vivamus ultricies est quam, vel gravida urna elementum nec. Vestibulum quis erat interdum, laoreet metus at, aliquet arcu. Nam dui lectus, volutpat eu nunc pharetra, faucibus adipiscing dolor. Pellentesque porta, arcu eu accumsan tincidunt, tortor ante tristique justo, in tincidunt sapien turpis vitae urna. Maecenas mattis ultricies laoreet. Mauris et blandit augue. Pellentesque dignissim nec nibh ut eleifend. Phasellus id tellus purus.</textarea>
      <span class="input-group-btn">
        <button id="get-json"class="btn-green" type="button">Try It!</button>
      </span>
    </div><!-- /input-group -->
  </form>
</div><!-- /.bar -->

<h3>Sample Output:</h3>
<pre>
  <code id='sampleOutput'>
  </code>
</pre>

<script>
  window.populateTryUri = function( service, uriClass ) {
    $.getJSON( '/sampleUri/' + service + '/' + uriClass, function( data, status ) {
      if( data.uri )
        $( '#sample-uri' ).val( data.uri );
    } ).fail( function( status ) {
      $( '#alert-area' ).html(
        '<div class="alert alert-danger fade in hidden">' +
        '  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>' +
        "  <strong>You haven't authenticated with the " + service + " API.</strong> Connect with a data source on the left to begin." +
        '</div>' );
      $( '#test-form' ).hide();

    });


    $.getJSON( '/genericUri/' + service + '/' + uriClass, function( data, status ) {
      if( data.uri )
        $( '#sampleUri' ).text( data.uri );
    }).fail( function( status ) {
      $( '#sampleUri' ).text( status.responseText );
    });

    $.getJSON( '/genericOutput/' + service + '/' + uriClass, function( result, status ) {
      $( '#sampleOutput' ).text( JSON.stringify( result, null, 2 ) );
    }).fail( function( status ) {
      $( '#sampleOutput' ).text( JSON.stringify( status, null, 2 ) );
    });

    $( '#get-json' ).click( function() {
      $.getJSON( '/getUri', { "uri": $( '#sample-uri' ).val() }, function( data, status ) {
        $( '#sampleOutput' ).text( JSON.stringify( data, null, 2 ));
      }).fail( function( status, error ) {
        $( '#sampleOutput' ).text( status.responseText );
      });
    });

  }

  $(function() {

    var totalHeight = '100%',

    $uriField = $('.js-input-expand');

    $uriField.each(function(i,el) {
      $(this).data('height', $(this).height());
    });

    $('.js-input-expand')
      .focus(function() {
          $(this).animate({
            height: $(this)[0].scrollHeight
          },
          'slow'
        );
      })

      .blur(function() {
          $(this).animate({
            height: totalHeight
          },
          'slow'
        );
      });
  });
</script>
