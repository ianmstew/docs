<div id="alert-area">
</div>

<div class="bar">
  <form role="form">
    <div class="input-group js-input-container">
      <textarea id="sample-uri" class="js-input-expand" rows="1" cols="100"></textarea>
      <span class="input-group-btn">
        <button class="btn-green" type="button">Try It!</button>
      </span>
    </div><!-- /input-group -->
  </form>
</div><!-- /.bar -->

<h1>User Profile</h1>
<h3>URI Format:</h3>
<p>
  <code id="sampleUri"></code>
</p>
<h3>Sample Output:</h3>
<pre>
  <code id="sampleUri">
  </code>
</pre>

<script>
  window.populateTryUri = function( service, uriClass ) {
    $.getJSON( '/sampleUri/' + service + '/' + uriClass, function( data, status ) {
      if( data.uri )
        $( '#sample-uri' ).val( data.uri );
    } ).fail( function( status ) {
      $( '#alert-area' ).html(
        '<div class="alert alert-danger fade in hidden">' +
        '  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>' +
        "  <strong>You haven't authenticated with the " + service + " API.</strong> Connect with a data source on the left to begin." +
        '</div>' );
      $( '#test-form' ).hide();

    });


    $.getJSON( '/genericUri/' + service + '/' + uriClass, function( data, status ) {
      if( data.uri )
        $( '#sampleUri' ).text( data.uri );
    }).fail( function( status ) {
      $( '#sampleUri' ).text( status.responseText );
    });

    $.getJSON( '/genericOutput/' + service + '/' + uriClass, function( result, status ) {
      $( '#sampleOutput' ).text( JSON.stringify( result, null, 2 ) );
    }).fail( function( status ) {
      $( '#sampleOutput' ).text( JSON.stringify( status, null, 2 ) );
    });

    $( '#get-json' ).click( function() {
      $.getJSON( '/getUri', { "uri": $( '#sample-uri' ).val() }, function( data, status ) {
        $( '#sampleOutput' ).text( JSON.stringify( data, null, 2 ));
      }).fail( function( status, error ) {
        $( '#sampleOutput' ).text( status.responseText );
      });
    });

  }

  $(function() {

    var totalHeight = '100%',
    $uriField = $('.js-input-expand');

    $uriField.each(function(i,el) {
      $(this).data('height', $(this).height());
    });

    $('.js-input-expand')
      .focus(function() {
          $(this).animate({
            height: 100
          },
          'slow'
        );
      })

      .blur(function() {
          $(this).animate({
            height: totalHeight
          },
          'slow'
        );
      });
  });
</script>
